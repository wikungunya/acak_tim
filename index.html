<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pengacak Tim</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            transition: background-color 0.3s ease;
        }
        /* CSS untuk dark mode */
        body.dark {
            background-color: #1a202c;
            color: #e2e8f0;
        }
        .dark .bg-white {
            background-color: #2d3748;
        }
        .dark .text-gray-800 {
            color: #cbd5e0;
        }
        .dark .text-gray-700 {
            color: #cbd5e0;
        }
        .dark .text-gray-600 {
            color: #a0aec0;
        }
        .dark .text-gray-500 {
            color: #718096;
        }
        .dark .bg-gray-100 {
            background-color: #4a5568;
        }
        .dark .bg-gray-300 {
            background-color: #5a6a84;
        }
        .dark .hover\:bg-gray-400:hover {
            background-color: #6a7d97;
        }
        /* CSS untuk animasi berputar */
        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        .spinning {
            animation: spin 1s linear infinite;
        }
        /* Style untuk logo */
        .logo-container {
            position: absolute;
            top: 2rem;
            left: 2rem;
        }
        .logo-container img {
            height: 5rem;
            width: auto;
        }
        @media (max-width: 640px) {
            .logo-container {
                top: 1rem;
                left: 1rem;
            }
            .logo-container img {
                height: 2.5rem;
            }
        }
        /* Style untuk koneksi offline */
        .offline-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: #ef4444; /* Warna merah */
            color: white;
            padding: 1rem;
            text-align: center;
            font-weight: bold;
            z-index: 1000;
            display: none;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="logo-container">
        <img src="https://iili.io/KaBRbHB.png" alt="Logo Pengacak Tim">
    </div>

    <div id="offline-banner" class="offline-banner">
        Koneksi internet terputus. Mohon periksa jaringan Anda. 
        <button id="refreshButton" class="bg-white text-red-500 py-1 px-3 rounded-full ml-4">
            Muat Ulang
        </button>
    </div>

    <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-lg mx-auto">
        <div class="flex justify-end mb-4">
            <button id="darkModeToggle" class="p-2 rounded-full bg-gray-200 dark:bg-gray-700 transition-colors duration-300">
                <svg id="sunIcon" class="h-6 w-6 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M10 2a.5.5 0 01.5.5v2a.5.5 0 01-1 0v-2A.5.5 0 0110 2zM4.9 3.8a.5.5 0 01-.354.854l-1.414 1.414a.5.5 0 01-.707-.707l1.414-1.414a.5.5 0 01.707.707zm10.2 0a.5.5 0 01.354-.854l1.414-1.414a.5.5 0 01.707.707L16.45 4.5a.5.5 0 01-.354.854zM2 10a.5.5 0 01.5-.5h2a.5.5 0 010 1h-2a.5.5 0 01-.5-.5zM17 10a.5.5 0 01.5-.5h2a.5.5 0 010 1h-2a.5.5 0 01-.5-.5zM3.8 15.1a.5.5 0 01.707-.707L4.5 16.45a.5.5 0 01-.707.707l-1.414-1.414a.5.5 0 01.707-.707zm11.3 0a.5.5 0 01-.707.707l-1.414 1.414a.5.5 0 01-.707-.707l1.414-1.414a.5.5 0 01.707-.707zM10 17a.5.5 0 01-.5-.5v-2a.5.5 0 011 0v2a.5.5 0 01-.5.5z"/>
                    <path fill-rule="evenodd" d="M10 3a7 7 0 100 14 7 7 0 000-14zm0 1a6 6 0 100 12A6 6 0 0010 4z" clip-rule="evenodd"/>
                </svg>
                <svg id="moonIcon" class="h-6 w-6 text-gray-400 hidden" fill="currentColor" viewBox="0 0 20 20">
                    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
                </svg>
            </button>
        </div>

        <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Pengacak Tim</h1>
        <p class="text-gray-600 mb-4 text-center">
            Masukkan nama anggota, satu nama per baris, dan tentukan jumlah anggota per tim.
        </p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <div>
                <label for="membersPerTeam" class="block text-gray-700 font-medium mb-1">Anggota per Tim</label>
                <input type="number" id="membersPerTeam" value="2" min="1" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <p class="text-sm text-gray-500 mt-1">Minimal 2 anggota per tim.</p>
            </div>
            <div>
                <label for="totalPlayersInput" class="block text-gray-700 font-medium mb-1">Total Pemain</label>
                <input type="number" id="totalPlayersInput" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                <p class="text-sm text-gray-500 mt-1">Masukkan jumlah total pemain yang akan diacak.</p>
            </div>
        </div>

        <div id="teamNameInputs" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4">
            </div>

        <div class="space-y-4">
            <textarea id="nameInput" rows="8" placeholder="Masukkan nama anggota di sini (satu per baris)..." class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-shadow resize-none"></textarea>
            <button id="shuffleButton" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition-colors duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                Acak Tim
            </button>
        </div>

        <div id="spinner" class="mt-8 flex justify-center hidden">
            <svg class="h-16 w-16 text-blue-500" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z" fill="currentColor"/>
                <path d="M12 4a8 8 0 018 8h-2a6 6 0 00-6-6V4z" fill="currentColor"/>
            </svg>
        </div>

        <div id="results" class="mt-8 space-y-6">
            </div>

        <div id="alertModal" class="fixed inset-0 z-50 hidden overflow-y-auto bg-gray-900 bg-opacity-50 flex items-center justify-center">
            <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full mx-4">
                <h2 class="text-xl font-bold text-gray-800 mb-2">Peringatan!</h2>
                <p id="alertMessage" class="text-gray-600 mb-4"></p>
                <div class="text-right">
                    <button id="closeAlert" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-full transition-colors duration-300">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const nameInput = document.getElementById('nameInput');
            const membersPerTeamInput = document.getElementById('membersPerTeam');
            const totalPlayersInput = document.getElementById('totalPlayersInput');
            const teamNameInputsDiv = document.getElementById('teamNameInputs');
            const shuffleButton = document.getElementById('shuffleButton');
            const resultsDiv = document.getElementById('results');
            const spinner = document.getElementById('spinner');
            const alertModal = document.getElementById('alertModal');
            const alertMessage = document.getElementById('alertMessage');
            const closeAlertButton = document.getElementById('closeAlert');
            const darkModeToggle = document.getElementById('darkModeToggle');
            const sunIcon = document.getElementById('sunIcon');
            const moonIcon = document.getElementById('moonIcon');
            const offlineBanner = document.getElementById('offline-banner');
            const refreshButton = document.getElementById('refreshButton');

            // --- Fitur Peringatan Koneksi ---
            function checkConnection() {
                if (navigator.onLine) {
                    offlineBanner.style.display = 'none';
                } else {
                    offlineBanner.style.display = 'block';
                }
            }
            
            checkConnection();
            window.addEventListener('online', checkConnection);
            window.addEventListener('offline', checkConnection);

            refreshButton.addEventListener('click', () => {
                window.location.reload();
            });
            // --- Akhir Fitur Peringatan Koneksi ---

            // --- Dark Mode Logic ---
            function setDarkMode(isDark) {
                if (isDark) {
                    document.body.classList.add('dark');
                    sunIcon.classList.add('hidden');
                    moonIcon.classList.remove('hidden');
                    localStorage.setItem('theme', 'dark');
                } else {
                    document.body.classList.remove('dark');
                    sunIcon.classList.remove('hidden');
                    moonIcon.classList.add('hidden');
                    localStorage.setItem('theme', 'light');
                }
            }

            const currentTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

            if (currentTheme === 'dark' || (currentTheme === null && prefersDark)) {
                setDarkMode(true);
            }

            darkModeToggle.addEventListener('click', () => {
                const isDark = document.body.classList.contains('dark');
                setDarkMode(!isDark);
            });
            // --- End Dark Mode Logic ---

            // Fungsi untuk menyimpan data ke Local Storage
            function saveState() {
                localStorage.setItem('names', nameInput.value);
                localStorage.setItem('membersPerTeam', membersPerTeamInput.value);
                localStorage.setItem('totalPlayers', totalPlayersInput.value);
            }

            // Fungsi untuk memuat data dari Local Storage
            function loadState() {
                const savedNames = localStorage.getItem('names');
                const savedMembersPerTeam = localStorage.getItem('membersPerTeam');
                const savedTotalPlayers = localStorage.getItem('totalPlayers');

                if (savedNames) {
                    nameInput.value = savedNames;
                }
                if (savedMembersPerTeam) {
                    membersPerTeamInput.value = savedMembersPerTeam;
                }
                if (savedTotalPlayers) {
                    totalPlayersInput.value = savedTotalPlayers;
                }
                updateTeamNameInputs();
            }

            function showAlert(message) {
                alertMessage.textContent = message;
                alertModal.classList.remove('hidden');
            }

            function updateTeamNameInputs() {
                const names = nameInput.value.split('\n').map(name => name.trim()).filter(name => name !== '');
                const membersPerTeam = parseInt(membersPerTeamInput.value, 10);
                
                if (isNaN(membersPerTeam) || membersPerTeam < 2) {
                    teamNameInputsDiv.innerHTML = '';
                    return;
                }

                const numberOfTeams = Math.floor(names.length / membersPerTeam);
                teamNameInputsDiv.innerHTML = '';

                for (let i = 1; i <= numberOfTeams; i++) {
                    const div = document.createElement('div');
                    div.innerHTML = `
                        <label for="teamName${i}" class="block text-gray-700 font-medium mb-1">Nama Tim ${i}</label>
                        <input type="text" id="teamName${i}" placeholder="Contoh: Tim ${i}" class="w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    `;
                    teamNameInputsDiv.appendChild(div);
                }
            }
            
            nameInput.addEventListener('input', () => {
                updateTeamNameInputs();
                saveState();
            });
            membersPerTeamInput.addEventListener('input', () => {
                updateTeamNameInputs();
                saveState();
            });
            totalPlayersInput.addEventListener('input', saveState);

            loadState();

            closeAlertButton.addEventListener('click', () => {
                alertModal.classList.add('hidden');
            });

            shuffleButton.addEventListener('click', () => {
                const names = nameInput.value
                    .split('\n')
                    .map(name => name.trim())
                    .filter(name => name !== '');

                const membersPerTeam = parseInt(membersPerTeamInput.value, 10);
                const totalPlayers = parseInt(totalPlayersInput.value, 10);

                if (names.length === 0) {
                    showAlert('Masukkan nama anggota terlebih dahulu.');
                    return;
                }
                if (isNaN(membersPerTeam) || membersPerTeam < 2) {
                    showAlert('Jumlah anggota per tim harus berupa angka dan minimal 2.');
                    return;
                }
                
                if (!isNaN(totalPlayers) && names.length !== totalPlayers) {
                    showAlert(`Jumlah nama yang dimasukkan (${names.length}) tidak cocok dengan jumlah total pemain (${totalPlayers}) yang Anda tentukan.`);
                    return;
                }

                if (names.length < membersPerTeam) {
                    showAlert(`Minimal ${membersPerTeam} nama diperlukan untuk satu tim.`);
                    return;
                }
                if (names.length % membersPerTeam !== 0) {
                    showAlert(`Jumlah total anggota (${names.length}) tidak dapat dibagi rata menjadi tim beranggotakan ${membersPerTeam} orang. Sisa anggota: ${names.length % membersPerTeam}.`);
                    return;
                }
                
                const numberOfTeams = Math.floor(names.length / membersPerTeam);

                shuffleButton.disabled = true;
                resultsDiv.innerHTML = '';
                spinner.classList.remove('hidden');
                spinner.querySelector('svg').classList.add('spinning');

                setTimeout(() => {
                    for (let i = names.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [names[i], names[j]] = [names[j], names[i]];
                    }

                    spinner.classList.add('hidden');
                    spinner.querySelector('svg').classList.remove('spinning');
                    shuffleButton.disabled = false;

                    const teamsData = [];
                    for (let i = 0; i < numberOfTeams; i++) {
                        const teamNameInput = document.getElementById(`teamName${i + 1}`);
                        const teamName = teamNameInput ? teamNameInput.value.trim() : `Tim ${i + 1}`;
                        const members = names.slice(i * membersPerTeam, (i + 1) * membersPerTeam);
                        teamsData.push({ name: teamName, members: members });
                    }

                    let resultsTextForCopy = "Hasil Pengacakan Tim:\n\n";

                    teamsData.forEach((team) => {
                        const teamCard = document.createElement('div');
                        teamCard.className = 'bg-gray-100 p-6 rounded-lg shadow-md';
                        
                        const membersList = team.members.map(member => `<li>${member}</li>`).join('');

                        teamCard.innerHTML = `
                            <h3 class="text-xl font-semibold text-gray-700 mb-2">${team.name}</h3>
                            <ul class="list-disc list-inside space-y-1 text-gray-600">
                                ${membersList}
                            </ul>
                            <button class="copy-button mt-4 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-1 px-3 rounded-full text-sm transition-colors duration-300">
                                Salin Tim Ini
                            </button>
                        `;
                        resultsDiv.appendChild(teamCard);

                        resultsTextForCopy += `${team.name}:\n`;
                        team.members.forEach(member => {
                            resultsTextForCopy += `- ${member}\n`;
                        });
                        resultsTextForCopy += "\n";
                    });

                    if (teamsData.length > 0) {
                        const copyAllButtonDiv = document.createElement('div');
                        copyAllButtonDiv.className = 'mt-6 text-center';
                        copyAllButtonDiv.innerHTML = `
                            <button id="copyAllTeams" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-5 rounded-lg transition-colors duration-300 transform hover:scale-105">
                                Salin Semua Hasil Tim
                            </button>
                        `;
                        resultsDiv.appendChild(copyAllButtonDiv);

                        document.getElementById('copyAllTeams').addEventListener('click', () => {
                            navigator.clipboard.writeText(resultsTextForCopy)
                                .then(() => {
                                    alert('Semua hasil tim berhasil disalin!');
                                })
                                .catch(err => {
                                    console.error('Gagal menyalin semua hasil tim:', err);
                                    alert('Gagal menyalin. Silakan coba secara manual.');
                                });
                        });
                    }

                    document.querySelectorAll('.copy-button').forEach(button => {
                        button.addEventListener('click', (event) => {
                            const teamCard = event.target.closest('.bg-gray-100');
                            const teamName = teamCard.querySelector('h3').textContent;
                            const members = Array.from(teamCard.querySelectorAll('li')).map(li => li.textContent);
                            
                            let textToCopy = `${teamName}:\n`;
                            members.forEach(member => {
                                textToCopy += `- ${member}\n`;
                            });

                            navigator.clipboard.writeText(textToCopy)
                                .then(() => {
                                    alert(`Tim "${teamName}" berhasil disalin!`);
                                })
                                .catch(err => {
                                    console.error('Gagal menyalin tim:', err);
                                    alert('Gagal menyalin. Silakan coba secara manual.');
                                });
                        });
                    });

                    // BARIS KODE BARU UNTUK MENGGULIR KE BAWAH
                    resultsDiv.scrollIntoView({ behavior: 'smooth' });

                }, 2000);
            });
        });
    </script>
</body>
</html>
